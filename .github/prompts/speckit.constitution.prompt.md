---
description: 基于交互输入或既有原则更新项目宪章，并确保所有相关模板同步。
---

## 用户输入

```text
$ARGUMENTS
```

若用户输入不为空，你**必须**在继续前先行考虑。

## 执行大纲

你需要更新 `.specify/memory/constitution.md` 中的项目宪章。该文件是一个模板，包含方括号占位符（如 `[PROJECT_NAME]`、`[PRINCIPLE_1_NAME]`）。你的任务是：(a) 收集或推导出具体值，(b) 精准替换模板内容，(c) 将所有改动传播到依赖的文档中。

按以下流程执行：

1. 读取 `.specify/memory/constitution.md` 现有模板。
   - 找出所有形如 `[ALL_CAPS_IDENTIFIER]` 的占位符。
   **重要**：用户可能需要的原则数量与模板不一致；若指定了数量，务必遵守并据此调整文档。

2. 收集或推导占位符取值：
   - 若对话中提供了值，直接使用。
   - 否则从仓库上下文推断（README、文档、过往宪章版本等）。
   - 治理日期：`RATIFICATION_DATE` 为最初采纳日期（未知则询问或写 TODO），`LAST_AMENDED_DATE` 若有改动则写今日，否则沿用旧值。
   - `CONSTITUTION_VERSION` 需按语义化版本规则递增：
     - 主版本（MAJOR）：有向下不兼容的治理/原则删除或重定义。
     - 次版本（MINOR）：新增原则/章节或显著扩充指导。
     - 修订版（PATCH）：澄清、措辞调整、拼写修复等非语义变更。
   - 若版本升级类型不明确，先给出理由再定案。

3. 起草更新后的宪章内容：
   - 替换全部占位符（除非刻意保留且需说明原因）。
   - 保留原有标题层级；被替换掉的注释可删除，除非仍有说明价值。
   - 每条原则需包含：精炼标题、描述不得违背的规则（段落或要点），如理由不明显需补充动机。
   - 治理章节需列出修订流程、版本策略及合规检查期望。

4. 一致性传播检查（把旧清单转为当前验证动作）：
   - 阅读 `.specify/templates/plan-template.md`，确保其中的“宪章校验”或规则与新原则一致。
   - 阅读 `.specify/templates/spec-template.md`，若宪章新增/删减强制章节或约束，需同步更新范围与需求。
   - 阅读 `.specify/templates/tasks-template.md`，确保任务分类覆盖新增或删除的原则驱动任务类型（如可观测性、版本策略、测试纪律）。
   - 阅读 `.specify/templates/commands/*.md`（包含本文件），确认未留有过时引用（如特定代理名称 CLAUDE 等）。
   - 阅读运行期指引（如 `README.md`、`docs/quickstart.md`、代理特定指引）。若引用了改动的原则需更新。

5. 生成同步影响报告（更新宪章后，作为 HTML 注释插入文件顶部）：
   - 版本变化：旧版本 → 新版本
   - 被修改的原则列表（若重命名，写成 旧标题 → 新标题）
   - 新增章节
   - 删除章节
   - 需更新的模板（✅ 已更新 / ⚠ 待处理）及路径
   - 后续 TODO（若有占位符暂未填充需说明）

6. 输出前的校验：
   - 不得留下未解释的方括号占位符。
   - 版本行需与报告一致。
   - 日期使用 ISO 格式 YYYY-MM-DD。
   - 各原则需具备可验证性，避免模糊措辞（如 “should” 替换为 MUST/SHOULD 并给出理由）。

7. 将完成的宪章写回 `.specify/memory/constitution.md`（覆盖原文件）。

8. 面向用户输出总结时需包含：
   - 新版本号及升级原因。
   - 需人工跟进的文件。
   - 建议提交信息（例如 `docs: amend constitution to vX.Y.Z (principle additions + governance update)`）。

格式与风格要求：

- 标题层级必须与模板一致（不可升降级）。
- 长段落可适度换行以提升可读性（理想 <100 字符）但不要生硬断句。
- 各节之间保留一个空行。
- 禁止结尾留有空格。

若用户仅提供部分更新（例如只改一条原则），仍需执行校验与版本判定步骤。

若关键信息缺失（如采纳日期确实未知），写入 `TODO(<FIELD_NAME>): 说明`，并在同步影响报告的延后项中列出。

不得创建新模板；务必在现有 `.specify/memory/constitution.md` 上操作。
